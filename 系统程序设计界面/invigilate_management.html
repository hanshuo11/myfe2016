<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">
    <title>软件工程</title>

    <!--data table-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css"
          rel="stylesheet"/>
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet">
</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <a href="index.html">XH manage</a>
        </div>
        <!--logo and iconic logo end-->

        <div class="left-side-inner">
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li><a href="index.html"><i class="fa fa-home"></i> <span>首页</span></a></li>
                <li class="menu-list"><a href="#"><i class="fa fa-laptop"></i> <span>任务信息</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="#">我的任务</a></li>
                        <li><a href="#">任务信息</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-book"></i> <span>工作管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="user_management.html">用户管理</a></li>
                    </ul>
                </li>
                <li class="menu-list active"><a href=""><i class="fa fa-tasks"></i> <span>监考信息</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="i_information.html">监考信息</a></li>
                        <li class="active"><a href="invigilate_management.html">监考管理</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>系统管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="system_setup.html">基点设置</a></li>
                    </ul>
                </li>
                <li><a href="login.html"><i class="fa fa-sign-in"></i> <span>注销</span></a></li>
            </ul>
        </div>
    </div>
    <!-- left side end-->

    <!-- main content start-->
    <div class="main-content">

        <!-- header section start-->
        <div class="header-section">

            <!--toggle button start-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--toggle button end-->

            <!--notification menu start -->
            <div class="menu-right">
                <ul class="notification-menu">
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-bell-o"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">消息提醒</h5>
                            <ul class="dropdown-list normal-list">
                                <li class="new">
                                    <a href="">
                                        <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                        <span class="name">请注意，您在5月31日有监考！</span>
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </li>
                    <li class="">
                        <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            <img src="images/photos/SuperUser.png" alt="">
                            超级管理员
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li><a href="#"><i class="fa fa-user"></i> 个人资料</a></li>
                            <li><a href="login.html"><i class="fa fa-sign-out"></i>注销</a></li>
                        </ul>
                    </li>

                </ul>
            </div>
            <!--notification menu end -->

        </div>
        <!-- header section end-->

        <!--body wrapper start-->
        <div class="wrapper">
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            添加监考：
                        </header>
                        <div class="panel-body">
                            <div class="clearfix">
                                <div class="btn-group">
                                    <form class="form-inline">
                                        <div class="form-group">
                                            监考地点：
                                            <input size="24" name="address" type="text" class="form-control"
                                                   placeholder="地点">
                                        </div>

                                        <div class="form-group">
                                            所需人数：
                                            <input size="24" name="number" type="text" class="form-control"
                                                   placeholder="监考人数">
                                        </div>
                                        <div class="form-group">
                                            课程名称：
                                            <input size="24" name="course" type="text" class="form-control"
                                                   placeholder="课程名称">
                                        </div>
                                        </br>
                                        </br>
                                        <div class="form-group">
                                            开始时间：
                                            <input name="start" id="datetimepicker1" size="24" type="text" readonly=""
                                                   class="form_datetime form-control">
                                        </div>

                                        <div class="form-group">
                                            结束时间：
                                            <input name="end" id="datetimepicker2" size="24" type="text" readonly=""
                                                   class="form_datetime form-control">
                                        </div>

                                        <button id="add_user" type="button" class="btn  btn-info">添加监考</button>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </section>
                    <section class="panel">
                        <header class="panel-heading">
                            监考管理表
                        </header>
                        <div id="user_table" class="panel-body">
                            <div class="adv-table">
                                <button id="btn_delete" type="button" class="btn btn-default">
                                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
                                </button>
                                <button id="btn_success" type="button" class="btn btn-success">
                                    <span class="glyphicon glyphicon-filter" aria-hidden="true"></span>已完成的监考
                                </button>
                                <table id="table" class="table table-striped table-hover table-bordered">
                                </table>
                            </div>
                        </div>
                    </section>
                    <!-- 弹出层 -->
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title">监考分配</h4>
                                </div>
                                <div class="modal-body row">
                                    <div class="col-md-12">
                                        <table id="invigilate_table"
                                               class="table table-striped table-hover table-bordered">
                                        </table>
                                        <div style="float: right;margin-top: 10px;">
                                            <button id="save_teach" class="btn btn-success " type="button">添加监考老师
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 弹出层 -->
                </div>
            </div>
        </div>
        <!--body wrapper end-->
    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.nicescroll.js"></script>
<script src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="js/bootstrap-table-editable.js"></script>
<script src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
<!--common scripts for all pages-->
<script src="js/scripts.js"></script>

<!-- END JAVASCRIPTS -->
<script>
    $(function () {
//        时间插件
        $('#datetimepicker1').datetimepicker({
            format: 'yyyy-mm-dd hh:ii', /*此属性是显示顺序，还有显示顺序是mm-dd-yyyy*/
            autoclose: true
        });
        $('#datetimepicker2').datetimepicker({
            format: 'yyyy-mm-dd hh:ii', /*此属性是显示顺序，还有显示顺序是mm-dd-yyyy*/
            autoclose: true
        });
//        表格数据初始化
        var $table = $('#table');
        $table.bootstrapTable({
            url: "data.json",         //请求后台的URL（*）
            method: 'get',                      //请求方式（*）
            striped: true,   //是否显示行间隔色
            singleSelect: false,
            sortStable: true,
            sortName: 'id',
            sortable: true,
            search: true,
            clickToSelect: true,
            sortOrder: "desc",
            pagination: true, //分页
            pageNumber: 1,   //初始化加载第一页，默认第一页
            pageSize: 5,   //每页的记录行数（*）
            pageList: [5, 10], //可供选择的每页的行数（*）
            sidePagination: "client", //服务端处理分页,
            showToggle: true,                    //是否显示详细视图和列表视图的切换按钮
            showColumns: true,                  //是否显示所有的列
            showRefresh: true,                  //是否显示刷新按钮
            columns: [
                {
                    field: 'id',
                    title: "<input class=\"choose_all\" type=\"checkbox\">",
                    formatter: function (value, row, index) {
                        return "<input  value=\"" + row.id + "\"  type=\"checkbox\">";
                    }
                },
                {
                    field: 'address',
                    title: '地点',
                    editable: {
                        type: 'text',
                        title: '考试地点'
                    }
                },
                {
                    field: 'course',
                    title: '课程名称',
                    editable: {
                        type: 'text',
                        title: '课程名称'
                    }
                },
                {
                    field: 'start',
                    title: '开始时间',
                    sortable: true,
                    editable: {
                        type: 'datetime',
                        title: '开始时间'
                    }
                }, {
                    field: 'end',
                    title: '结束时间',
                    editable: {
                        type: 'datetime',
                        title: '结束时间',
                    }
                },
                {
                    title: '所需人数',
                    field: 'number',
                    align: 'center',
                    editable: {
                        type: 'text',
                        title: '所需人数'
                    }
                },
                {
                    //                <a href="#myModal" data-toggle="modal"> 56566 </a>
                    field: 'invigilate_state',
                    title: '监考已分配人数',
                    sortable: true,
                    formatter: function (value, row, index) {
                        if (row.invigilate_state == 0) {
                            return "<a class='get_one' href='#myModal' data-toggle='modal' invigilate_id=\"" + row.invigilate_id + "\" >0</a>";
                        } else if (row.invigilate_state == 1) {
                            return "<a class='get_one'  href='#myModal' data-toggle='modal' invigilate_id=\"" + row.invigilate_id + "\" >" + row.teacher_number + "</a>";
                        }

                    }

                },
            ],
            onEditableSave: function (field, row, oldValue, $el) {
//            row就是当前这一行的json形式例如：{id: 1, userName: "韩硕", password: "56788", profession: "副教授", rank_id: 3}
                console.log(row);
//            $.ajax({
//                type: "post",
//                url: "/Editable/Edit",
//                data: row,
//                dataType: 'JSON',
//                success: function (data, status) {
//                    if (status == "success") {
//                        alert('提交数据成功');
//                    }
//                },
//                error: function () {
//                    alert('编辑失败');
//                },
//                complete: function () {
//                }
//            });
            }
        });
//        点击加载已完成监考表,后台获取已经完成的数据并更新表格
        $("#btn_success").on("click", function () {
//            $.get('url',{}, function (data) {
//                if (data) {
////                    更新表单数据，data为返回的json数据
//                    $table.bootstrapTable('load', data);
//                } else {
//                    alert('筛选失败!');
//                }
//            }, 'text');
            $.getJSON("data2.json", function (data) {
                $table.bootstrapTable('load', data);
            });
        })
        //点击添加按钮，添加监考发送ajax请求
        $('#add_user').on('click', function () {
            var address = $("input[name^='address']");
            var start = $("input[name^='start']");
            var end = $("input[name^='end']");
            var number = $("input[name^='number']");
            var course = $("input[name^='course']");
            if (address.val() == "" || number.val() == "" || start.val() == "" || end.val() == "") {
                alert("添加内容不能为空！");
                return false;
            } else {
//            添加后清空input的内容
                address.val("");
                start.val("");
                end.val("");
                number.val("");
                course.val("")
                $.post('url', {
                    'address': address.val(),
                    'start': start.val(),
                    'end': end.val(),
                    'number': number.val(),
                    'course': course.val()
                }, function (data) {
                    if (data == 'ok') {
                        var index = $table.bootstrapTable('getData').length;
                        $table.bootstrapTable('insertRow', {
                            index: index,
                            row: {
                                id: id,
                                address: address.val(),
                                start: start.val(),
                                end: end.val(),
                                number: number.val()
                            }
                        });
                        $("button [name='refresh']").trigger('click');
                    } else {
                        alert('添加失败!');
                    }
                }, 'text');
            }
        });

        //    删除监考发送ajax请求
        $('#btn_delete').on('click', function () {
//        选择多个str为选择的id 例如“ 1,2,3  或者  1 ”
            var str = "";
            $('.table :checked').each(function () {
                str += this.value + ',';
            });
            str = str.slice(0, -1);
            $.get('url', {
                'ids': str
            }, function (data) {
                if (data == 'ok') {
                    $('#table :checked').parent().parent().fadeOut(800, function () {
                        $(this).remove();
                    });
                } else {
                    alert('删除失败!');
                }
            }, 'text');
        });

        //        监教师分配表

        setTimeout(function () {
            $(".get_one").on('click', function () {
//                获取点击的invigilate_id值
                var invigilate_id = $(this).attr("invigilate_id");
//                console.log(invigilate_id);
                var Number = 0;
                var arr=[];
                //                通过ajax获得点击该invigilate_id的所需人数和已经选取的监考老师id
                $.post('url', {invigilate_id: invigilate_id}, function (data) {
                    if (data) {
//                        data里面需要该考场的所需人数Number、已经选择过的教师id数组arr，进行赋值
                    } else {
                        alert("数据获取失败！");
                        return false;
                    }
                }, 'text');
//               得到要查询的invigilate_id发送ajax请求得到所有监考老师
                var $table = $('#invigilate_table');
                $table.bootstrapTable({
                    url: 'url',         //请求后台的URL（*）
                    method: 'get',                      //请求方式（*）
                    striped: true,   //是否显示行间隔色
                    singleSelect: false,
                    sortStable: true,
                    sortName: 'id',
                    sortable: true,
                    clickToSelect: true,
                    sortOrder: "desc",
                    pagination: true, //分页
                    pageNumber: 1,   //初始化加载第一页，默认第一页
                    pageSize: 5,   //每页的记录行数（*）
                    pageList: [5, 10], //可供选择的每页的行数（*）
                    sidePagination: "client", //服务端处理分页,
                    showColumns: true,                  //是否显示所有的列
                    showRefresh: true,                  //是否显示刷新按钮
                    columns: [
                        {
                            field: 'id',
                            title: "#",
                            formatter: function (value, row, index) {
                                if (Number == row.id) {
                                    return "<input name='check'  value=\"" + row.id + "\"  type=\"checkbox\" checked='checked'>";
                                } else {
                                    return "<input name='check'  value=\"" + row.id + "\"  type=\"checkbox\">";
                                }
                            }
                        },
                        {
                            field: 'userName',
                            title: '用户名'
                        },
                        {
                            field: 'profession',
                            title: '职位'
                        },
                        {
                            field: 'invigilate_number',
                            title: '已监考次数',
                            sortable: true
                        }
                    ]
//                    伪数据
                    , data: [{
                        id: 0,
                        userName: '韩硕',
                        profession: '老师',
                        invigilate_number: 3
                    }, {
                        id: 1,
                        userName: '鱼鱼',
                        profession: '老师',
                        invigilate_number: 0
                    }]
                });
                $("#save_teach").on('click', function () {
                    var check_number = $("input[name='check']:checked");
                    console.log(check_number.length);
//                    if (check_number.length > Number) {
//                        alert("选择人数超出规所需人数！");
//                        return false;
//                    } else if (check_number.length < Number) {
//                        alert("选择人数少于所需人数！");
//                        return false;
//                    } else {
                    var str = "";
                    $('#invigilate_table :checked').each(function () {
                        str += this.value + ',';
                    });
                    str = str.slice(0, -1);
                    console.log(str);
//                        $.get('url', {
////                            发送添加的教师id，例如“1，2，3”
//                            'user_id': str
//                        }, function (data) {
//                            if (data == 'ok') {
////                                关闭弹出层，刷新分配表
//                                $('.close').trigger('click');
//                                $("button [name='refresh']").trigger('click');
//                            } else {
//                                alert('添加失败!');
//                            }
//                        }, 'text');
//                    }
                })
            })
        }, 300);
    })
</script>

</body>
</html>
