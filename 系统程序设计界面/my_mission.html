<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="ThemeBucket">
    <link rel="shortcut icon" href="#" type="image/png">
    <title>软件工程</title>

    <!--data table-->
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.css">
    <!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
    <link rel="stylesheet" href="https://cdn.bootcss.com/bootstrap/3.3.7/css/bootstrap.min.css"
          integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" href="js/bootstrap-datetimepicker/css/bootstrap-datetimepicker.css">
    <link href="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/css/bootstrap-editable.css"
          rel="stylesheet"/>
    <link href="css/style.css" rel="stylesheet">
    <link href="css/style-responsive.css" rel="stylesheet">
</head>

<body class="sticky-header">

<section>
    <!-- left side start-->
    <div class="left-side sticky-left-side">

        <!--logo and iconic logo start-->
        <div class="logo">
            <a href="index.html">XH manage</a>
        </div>
        <!--logo and iconic logo end-->

        <div class="left-side-inner">
            <ul class="nav nav-pills nav-stacked custom-nav">
                <li><a href="index.html"><i class="fa fa-home"></i> <span>首页</span></a></li>
                <li class="menu-list active"><a href="#"><i class="fa fa-laptop"></i> <span>任务信息</span></a>
                    <ul class="sub-menu-list">
                        <li class="active"><a href="#">我的任务</a></li>
                        <li><a href="#">任务信息</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-book"></i> <span>工作管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="user_management.html">用户管理</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-tasks"></i> <span>监考信息</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="i_information.html">监考信息</a></li>
                        <li><a href="invigilate_management.html">监考管理</a></li>
                    </ul>
                </li>
                <li class="menu-list"><a href=""><i class="fa fa-cogs"></i> <span>系统管理</span></a>
                    <ul class="sub-menu-list">
                        <li><a href="system_setup.html">基点设置</a></li>
                    </ul>
                </li>
                <li><a href="login.html"><i class="fa fa-sign-in"></i> <span>注销</span></a></li>
            </ul>
        </div>
    </div>
    <!-- left side end-->

    <!-- main content start-->
    <div class="main-content">

        <!-- header section start-->
        <div class="header-section">

            <!--toggle button start-->
            <a class="toggle-btn"><i class="fa fa-bars"></i></a>
            <!--toggle button end-->

            <!--notification menu start -->
            <div class="menu-right">
                <ul class="notification-menu">
                    <li>
                        <a href="#" class="btn btn-default dropdown-toggle info-number" data-toggle="dropdown">
                            <i class="fa fa-bell-o"></i>
                            <span class="badge">1</span>
                        </a>
                        <div class="dropdown-menu dropdown-menu-head pull-right">
                            <h5 class="title">消息提醒</h5>
                            <ul class="dropdown-list normal-list">
                                <li class="new">
                                    <a href="">
                                        <span class="label label-danger"><i class="fa fa-bolt"></i></span>
                                        <span class="name">请注意，您在5月31日有监考！</span>
                                    </a>
                                </li>

                            </ul>
                        </div>
                    </li>
                    <li class="">
                        <a href="#" class="btn btn-default dropdown-toggle" data-toggle="dropdown">
                            <img src="images/photos/SuperUser.png" alt="">
                            超级管理员
                            <span class="caret"></span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-usermenu pull-right">
                            <li><a href="#"><i class="fa fa-user"></i> 个人资料</a></li>
                            <li><a href="login.html"><i class="fa fa-sign-out"></i>注销</a></li>
                        </ul>
                    </li>

                </ul>
            </div>
            <!--notification menu end -->

        </div>
        <!-- header section end-->

        <!--body wrapper start-->
        <div class="wrapper">
            <div class="row">
                <div class="col-sm-12">
                    <section class="panel">
                        <header class="panel-heading">
                            我的任务
                        </header>
                        <div id="user_table" class="panel-body">
                            <div class="adv-table">
                                <table id="table" class="table table-striped table-hover table-bordered">
                                </table>
                            </div>
                        </div>
                    </section>
                    <!-- 弹出层 -->
                    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                         aria-hidden="true">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">
                                        &times;
                                    </button>
                                    <h4 class="modal-title">任务回复</h4>
                                </div>
                                <div class="modal-body row">
                                    <div class="col-md-12">
                                        <form method="post" action="url" name="form">
                                            <h4>任务名称:</h4>
                                            <p style="padding: 10px;border-radius: 10px;font-size: 18px;"
                                               id="mission_name" class="bg-info">
                                                上传财务报表
                                            </p>
                                            <h4>任务描述:</h4>
                                            <p style="padding: 10px;border-radius: 10px;" id="mission_content"
                                               class="bg-success">
                                                链接的原始功能不受影响
                                                上面提到的类只是通过设置 pointer-events: none 来禁止 元素作为链接的原始功能，但是，这一 CSS 属性并没有被标准化，并且
                                                Opera 18 及更低版本的浏览器并没有完全支持这一属性，同样，Internet Explorer 11 也不支持。In addition,
                                                even in browsers that do support pointer-events: none, keyboard
                                                navigation remains unaffected, meaning that sighted keyboard users and
                                                users of assistive technologies will still be able to activate these
                                                links. 因此，为了安全起见，建议通过 JavaScript 代码来禁止链接的原始功能。
                                            </p>
                                            <div class="form-group">
                                                <h4>上传文件:</h4>
                                                <input name="send_file" type="file" id="exampleInputFile">
                                            </div>
                                            <h4>回复消息:</h4>
                                            <textarea name="content" class="form-control" rows="5"
                                                      style="margin-top: 10px;"></textarea>
                                        </form>
                                        <div style="float: right;margin-top: 10px; margin-right: 20px;">
                                            <button id="save" class="btn btn-success " type="button"
                                                    style="height:34px;width:80px;font-size: 15px;">回复任务
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- 弹出层 -->
                </div>
            </div>
        </div>
        <!--body wrapper end-->
    </div>
    <!-- main content end-->
</section>

<!-- Placed js at the end of the document so the pages load faster -->
<script src="js/jquery-1.10.2.min.js"></script>
<script src="js/jquery-ui-1.9.2.custom.min.js"></script>
<script src="js/jquery-migrate-1.2.1.min.js"></script>
<script src="js/bootstrap.min.js"></script>
<script src="js/modernizr.min.js"></script>
<script src="js/jquery.nicescroll.js"></script>
<script src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/bootstrap-table.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.11.1/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/x-editable/1.5.0/bootstrap3-editable/js/bootstrap-editable.min.js"></script>
<script src="js/bootstrap-table-editable.js"></script>
<script src="js/bootstrap-datetimepicker/js/bootstrap-datetimepicker.js"></script>
<!--common scripts for all pages-->
<script src="js/scripts.js"></script>

<!-- END JAVASCRIPTS -->
<script>
    $(function () {
//        表格数据初始化
        var type = null;
        var $table = $('#table');
        $table.bootstrapTable({
            url: "data3.json",         //请求后台的URL（*）
            method: 'get',                      //请求方式（*）
            striped: true,   //是否显示行间隔色
            singleSelect: false,
            sortStable: true,
            sortName: 'endtime',
            sortable: true,
            search: true,
            clickToSelect: true,
            sortOrder: "desc",
            pagination: true, //分页
            pageNumber: 1,   //初始化加载第一页，默认第一页
            pageSize: 5,   //每页的记录行数（*）
            pageList: [5, 10], //可供选择的每页的行数（*）
            sidePagination: "client", //服务端处理分页,
            showToggle: true,                    //是否显示详细视图和列表视图的切换按钮
            showColumns: true,                  //是否显示所有的列
            showRefresh: true,                  //是否显示刷新按钮
            columns: [
                {
                    field: 'name',
                    title: '任务名称'
                },
                {
                    field: 'user_name',
                    title: '发布人'
                },
                {
                    field: 'endtime',
                    title: '截止时间',
                    sortable: true
                },
                {
                    field: 'state',
                    title: "完成状态",
                    formatter: function (value, row, index) {
                        if (row.state == 2) {
                            return "<strong class='state'>已处理</strong>";
                        } else if (row.state == 1) {
                            return "<strong class='state'>已回复</strong>";
                        } else if (row.state == 0) {
                            return "<strong class='state'>未回复</strong>";
                        }
                    }
                },
                {
                    //                <a href="#myModal" data-toggle="modal"> 56566 </a>
                    field: 'type',
                    title: '任务类型',
                    formatter: function (value, row, index) {
                        if (row.type == 0) {
                            return "<a class='get_one btn btn-warning' href='#myModal' data-toggle='modal' id=\"" + row.id + "\" type=\"" + row.type + "\">回复消息</a>";
                        } else if (row.type == 1) {
                            return "<a class='get_one btn btn-info'  href='#myModal' data-toggle='modal' id=\"" + row.id + "\" type=\"" + row.type + "\">上传文件</a>";
                        }
                    }

                },
            ]
        });
        setTimeout(function () {
            $(".get_one").on('click', function () {
                type = $(this).attr("type");
//                id为获取到的任务id
                var id = $(this).attr("id");
                var state=$(this).parent().parent().children().eq(3).children();
//                发送任务id获取到任务的详细信息
                $.post('url', {
                    'id': id
                }, function (data) {
                    if (data) {
                        $("#mission_name").text(data.name);
                        $("#mission_content").text(data.content);
                    } else {
                        $("#mission_name").text("获取信息失败请稍后重试");
                        $("#mission_content").text("获取信息失败请稍后重试");
                    }
                }, 'text');
            });
            $("#save").on("click", function () {
                var file = document.form.send_file.value;
                var content=document.form.content.value;
                if (type==1&&file=="") {
                    alert("请选择文件！");
                } else if (type==0&&file!="") {
                    alert("回复类型为消息，请勿选择文件！");
                }else if(type==0&&content==""){
                    alert("请填写回复内容！");
                };
//                ajax发送文件或者回复消息
                $.post('url', {

                }, function (data) {
                    if (data=="ok") {
                        alert("发送成功！");
                        state.text("已回复");
                        $(".close").trigger("click");
                    } else {
                        alert("发送失败请稍后重试！");
                        $(".close").trigger("click");
                    }
                }, 'text');
            })
        }, 200)

    })
</script>

</body>
</html>
